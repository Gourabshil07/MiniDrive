<!DOCTYPE html>
<html>
<head>
    <title>ðŸš€ Admin Dashboard</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
          rel="stylesheet">

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap"
          rel="stylesheet">

<style>

body{
    font-family:'Poppins', sans-serif;
    background:#eef2f7;
}

/* Header */
.page-title{
    font-weight:600;
}

/* Card */
.card{
    border-radius:16px;
}

/* Table */
.table thead{
    background:#0f172a;
    color:white;
}

.table{
    border-radius:12px;
    overflow:hidden;
}

/* Badge */
.badge{
    padding:6px 12px;
    font-weight:500;
}

/* Delete Button */
.btn-danger{
    border-radius:8px;
}

/* Modal */
.modal-content{
    border-radius:18px;
}

</style>

</head>

<body>

<div class="container-fluid px-5 mt-4">

    <!-- HEADER -->
    <div class="d-flex justify-content-between align-items-center mb-4">

        <h2 class="page-title">ðŸš€ Admin Dashboard</h2>

        <a href="/dashboard" class="btn btn-primary px-4">
            Back to Drive
        </a>

    </div>


    <!-- CARD -->
    <div class="card shadow-sm border-0">

        <div class="card-body">

            <table class="table table-hover align-middle">

                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Username</th>
                        <th>Role</th>
                        <th style="width:240px;">Storage</th>
                        <th>Action</th>
                    </tr>
                </thead>

                <tbody>

                {% for user in users %}
                <tr>

                    <td>{{ user.id }}</td>

                    <td class="fw-semibold">
                        {{ user.username }}
                    </td>

                    <td>
                        {% if user.role == "admin" %}
                            <span class="badge bg-danger">Admin</span>
                        {% else %}
                            <span class="badge bg-secondary">User</span>
                        {% endif %}
                    </td>

                    <!-- STORAGE BAR -->
                    <td>

                        <div class="progress" style="height:8px;">
                            <div class="progress-bar bg-primary"
                                 style="width: {{ user.storage * 10 }}%;">
                            </div>
                        </div>

                        <small class="text-muted">
                            {{ user.storage }} MB used
                        </small>

                    </td>

                    <!-- ACTION -->
                    <td>

                    {% if user.username == session["user"] %}

                        <span class="text-muted fw-semibold">(You)</span>

                    {% else %}

                        <button class="btn btn-sm btn-danger"
                                onclick="openDeleteModal('{{ user.username }}')">
                            Delete
                        </button>

                    {% endif %}

                    </td>

                </tr>
                {% endfor %}

                </tbody>

            </table>

        </div>
    </div>

</div>


<!--DELETE MODAL -->

<div class="modal fade" id="deleteModal" tabindex="-1">

  <div class="modal-dialog modal-dialog-centered">

    <div class="modal-content border-0 shadow">

      <div class="modal-header border-0">

        <h5 class="modal-title text-danger fw-bold">
            âš  Permanently Delete User?
        </h5>

      </div>

      <div class="modal-body text-center">

        <p class="fs-5 fw-semibold">
            This will permanently remove the user,
            all files, folders, and stored data.
        </p>

        <p class="text-danger">
            This action cannot be undone.
        </p>

      </div>

      <div class="modal-footer border-0 justify-content-center">

        <button class="btn btn-light px-4"
                data-bs-dismiss="modal">
            Cancel
        </button>

        <form id="deleteForm" method="POST">
            <button class="btn btn-danger px-4 fw-semibold">
                Delete Permanently
            </button>
        </form>

      </div>

    </div>
  </div>
</div>


<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>

function openDeleteModal(username){

    document.getElementById("deleteForm").action =
        "/admin/delete-user/" + username;

    const modal = new bootstrap.Modal(
        document.getElementById("deleteModal")
    );

    modal.show();
}

</script>

</body>
</html>
